!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).TomSelect=t()}(this,function(){"use strict";function h(e,t){return"number"==typeof e&&"number"==typeof t?t<e?1:e<t?-1:0:(e=i(String(e||"")))>(t=i(String(t||"")))?1:e<t?-1:0}function g(e,t,i){if(e&&t){if(!i)return e[t];for(var s=t.split(".");s.length&&(e=e[s.shift()]););return e}}var l={a:"[aḀḁĂăÂâǍǎȺⱥȦȧẠạÄäÀàÁáĀāÃãÅåąĄÃąĄ]",b:"[b␢βΒB฿𐌁ᛒ]",c:"[cĆćĈĉČčĊċC̄c̄ÇçḈḉȻȼƇƈɕᴄＣｃ]",d:"[dĎďḊḋḐḑḌḍḒḓḎḏĐđD̦d̦ƉɖƊɗƋƌᵭᶁᶑȡᴅＤｄð]",e:"[eÉéÈèÊêḘḙĚěĔĕẼẽḚḛẺẻĖėËëĒēȨȩĘęᶒɆɇȄȅẾếỀềỄễỂểḜḝḖḗḔḕȆȇẸẹỆệⱸᴇＥｅɘǝƏƐε]",f:"[fƑƒḞḟ]",g:"[gɢ₲ǤǥĜĝĞğĢģƓɠĠġ]",h:"[hĤĥĦħḨḩẖẖḤḥḢḣɦʰǶƕ]",i:"[iÍíÌìĬĭÎîǏǐÏïḮḯĨĩĮįĪīỈỉȈȉȊȋỊịḬḭƗɨɨ̆ᵻᶖİiIıɪＩｉ]",j:"[jȷĴĵɈɉʝɟʲ]",k:"[kƘƙꝀꝁḰḱǨǩḲḳḴḵκϰ₭]",l:"[lŁłĽľĻļĹĺḶḷḸḹḼḽḺḻĿŀȽƚⱠⱡⱢɫɬᶅɭȴʟＬｌ]",n:"[nŃńǸǹŇňÑñṄṅŅņṆṇṊṋṈṉN̈n̈ƝɲȠƞᵰᶇɳȵɴＮｎŊŋ]",o:"[oØøÖöÓóÒòÔôǑǒŐőŎŏȮȯỌọƟɵƠơỎỏŌōÕõǪǫȌȍՕօ]",p:"[pṔṕṖṗⱣᵽƤƥᵱ]",q:"[qꝖꝗʠɊɋꝘꝙq̃]",r:"[rŔŕɌɍŘřŖŗṘṙȐȑȒȓṚṛⱤɽ]",s:"[sŚśṠṡṢṣꞨꞩŜŝŠšŞşȘșS̈s̈]",t:"[tŤťṪṫŢţṬṭƮʈȚțṰṱṮṯƬƭ]",u:"[uŬŭɄʉỤụÜüÚúÙùÛûǓǔŰűŬŭƯưỦủŪūŨũŲųȔȕ∪]",v:"[vṼṽṾṿƲʋꝞꝟⱱʋ]",w:"[wẂẃẀẁŴŵẄẅẆẇẈẉ]",x:"[xẌẍẊẋχ]",y:"[yÝýỲỳŶŷŸÿỸỹẎẏỴỵɎɏƳƴ]",z:"[zŹźẐẑŽžŻżẒẓẔẕƵƶ]"},i=function(){var e,t,i,s,n="",o={};for(i in l)if(l.hasOwnProperty(i))for(n+=s=l[i].substring(2,l[i].length-1),e=0,t=s.length;e<t;e++)o[s.charAt(e)]=i;var r=new RegExp("["+n+"]","g");return function(e){return e.replace(r,function(e){return o[e]}).toLowerCase()}}();class a{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t){if(!(e=String(e||"").toLowerCase().trim())||!e.length)return[];for(var i,s,n=[],o=e.split(/ +/),r=0,a=o.length;r<a;r++){if(i=(o[r]+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),this.settings.diacritics)for(s in l)l.hasOwnProperty(s)&&(i=i.replace(new RegExp(s,"g"),l[s]));t&&(i="\\b"+i),n.push({string:o[r],regex:new RegExp(i,"i")})}return n}iterator(e,t){(Array.isArray(e)?Array.prototype.forEach||function(e){for(var t=0,i=this.length;t<i;t++)e(this[t],t,this)}:function(e){for(var t in this)this.hasOwnProperty(t)&&e(this[t],t,this)}).apply(e,[t])}getScoreFunction(e,t){function n(e,t){var i;return!e||-1===(i=(e=String(e||"")).search(t.regex))?0:(e=t.string.length/e.length,0===i&&(e+=.5),e)}var o,t=this.prepareSearch(e,t),r=t.tokens,a=t.options.fields,l=r.length,d=t.options.nesting,c=(o=a.length)?1===o?function(e,t){return n(g(t,a[0],d),e)}:function(e,t){for(var i=0,s=0;i<o;i++)s+=n(g(t,a[i],d),e);return s/o}:function(){return 0};return l?1===l?function(e){return c(r[0],e)}:"and"===t.options.conjunction?function(e){for(var t,i=0,s=0;i<l;i++){if((t=c(r[i],e))<=0)return 0;s+=t}return s/l}:function(e){for(var t=0,i=0;t<l;t++)i+=c(r[t],e);return i/l}:function(){return 0}}getSortFunction(e,i){var t,s,n,o,r,a,l,d,c=!(e=(n=this).prepareSearch(e,i)).query&&i.sort_empty||i.sort,p=function(e,t){return"$score"===e?t.score:g(n.items[t.id],e,i.nesting)},u=[];if(c)for(t=0,s=c.length;t<s;t++)!e.query&&"$score"===c[t].field||u.push(c[t]);if(e.query){for(d=!0,t=0,s=u.length;t<s;t++)if("$score"===u[t].field){d=!1;break}d&&u.unshift({field:"$score",direction:"desc"})}else for(t=0,s=u.length;t<s;t++)if("$score"===u[t].field){u.splice(t,1);break}for(l=[],t=0,s=u.length;t<s;t++)l.push("desc"===u[t].direction?-1:1);return(r=u.length)?1===r?(o=u[0].field,a=l[0],function(e,t){return a*h(p(o,e),p(o,t))}):function(e,t){for(var i,s=0;s<r;s++)if(i=u[s].field,i=l[s]*h(p(i,e),p(i,t)))return i;return 0}:null}prepareSearch(e,t){if("object"==typeof e)return e;var i=(t=Object.assign({},t)).fields,s=t.sort,n=t.sort_empty;return i&&!Array.isArray(i)&&(t.fields=[i]),s&&!Array.isArray(s)&&(t.sort=[s]),n&&!Array.isArray(n)&&(t.sort_empty=[n]),{options:t,query:String(e||"").toLowerCase(),tokens:this.tokenize(e,t.respect_word_boundaries),total:0,items:[]}}search(e,i){var s,n,t=this,o=this.prepareSearch(e,i);return i=o.options,e=o.query,n=i.score||t.getScoreFunction(o),e.length?t.iterator(t.items,function(e,t){s=n(e),(!1===i.filter||0<s)&&o.items.push({score:s,id:t})}):t.iterator(t.items,function(e,t){o.items.push({score:1,id:t})}),(t=t.getSortFunction(o,i))&&o.items.sort(t),o.total=o.items.length,"number"==typeof i.limit&&(o.items=o.items.slice(0,i.limit)),o}}const d="undefined"!=typeof navigator&&/Mac/.test(navigator.userAgent)?"metaKey":"ctrlKey";var o={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,closeAfterSelect:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-control",inputClass:"ts-input",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:null,copyClassesToDropdown:!0,placeholder:null,hidePlaceholder:null,shouldLoad:function(e){return 0<e.length},render:{}};function C(e){return null==e?null:"boolean"==typeof e?e?"1":"0":e+""}function r(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function s(t,i,e){var s,n=t.trigger,o={};for(s in t.trigger=function(){var e=arguments[0];if(-1===i.indexOf(e))return n.apply(t,arguments);o[e]=arguments},e.apply(t,[]),t.trigger=n,o)n.apply(t,o[s])}function v(e,t=!1){e&&(e.preventDefault(),t&&e.stopPropagation())}function f(e,t,i,s){e.addEventListener(t,i,s)}function c(e,t){return t&&t[e]&&1==(t.altKey?1:0)+(t.ctrlKey?1:0)+(t.shiftKey?1:0)+(t.metaKey?1:0)}function m(e,t){return e.getAttribute("id")||(e.setAttribute("id",t),t)}function p(i,e){var t,l=Object.assign({},o,e),d=l.dataAttr,c=l.labelField,p=l.valueField,u=l.disabledField,h=l.optgroupField,g=l.optgroupLabelField,v=l.optgroupValueField,s=i.tagName.toLowerCase(),n=i.getAttribute("placeholder")||i.getAttribute("data-placeholder");n||l.allowEmptyOption||(t=i.querySelector('option[value=""]'))&&(n=t.textContent);var f={placeholder:n,options:[],optgroups:[],items:[],maxItems:null};return("select"===s?()=>{var e,n=f.options,o={},s=1,r=e=>{var t=Object.assign({},e.dataset),e=d&&t[d];return t="string"==typeof e&&e.length?Object.assign(t,JSON.parse(e)):t},a=(e,t)=>{var i,s=C(e.value);(s||l.allowEmptyOption)&&(o.hasOwnProperty(s)?t&&((i=o[s][h])?Array.isArray(i)?i.push(t):o[s][h]=[i,t]:o[s][h]=t):((i=r(e))[c]=i[c]||e.textContent,i[p]=i[p]||s,i[u]=i[u]||e.disabled,i[h]=i[h]||t,i.$option=e,o[s]=i,n.push(i),e.selected&&f.items.push(s)))};f.maxItems=i.hasAttribute("multiple")?null:1;for(const l of i.children)"optgroup"===(e=l.tagName.toLowerCase())?(e=>{var t,i;(i=r(e))[g]=i[g]||e.getAttribute("label")||"",i[v]=i[v]||s++,i[u]=i[u]||e.disabled,f.optgroups.push(i),t=i[v];for(const i of e.children)a(i,t)})(l):"option"===e&&a(l)}:()=>{var e,t=i.getAttribute(d);if(t){f.options=JSON.parse(t);for(const i of f.options)f.items.push(i[p])}else{var t=i.value.trim()||"";if(l.allowEmptyOption||t.length){for(const i of t=t.split(l.delimiter))(e={})[c]=i,e[p]=i,f.options.push(e);f.items=t}}})(),Object.assign({},o,f,e)}function y(t){if(t.jquery)return t[0];if(t instanceof HTMLElement)return t;if(-1<t.indexOf("<")){let e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}return document.querySelector(t)}function n(e,t){var i=document.createEvent("HTMLEvents");i.initEvent(t,!0,!1),e.dispatchEvent(i)}function u(e,t){Object.assign(e.style,t)}function b(e,...t){var i=O(t);(e=w(e)).map(t=>{i.map(e=>{t.classList.add(e)})})}function I(e,...t){var i=O(t);(e=w(e)).map(t=>{i.map(e=>{t.classList.remove(e)})})}function O(e){var t,i=[];for(t of e)"string"==typeof t&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(i=i.concat(t));return i.filter(Boolean)}function w(e){return e=!Array.isArray(e)?[e]:e}function _(e,t,i){if(!i||i.contains(e))for(;e&&e.matches;){if(e.matches(t))return e;e=e.parentNode}}function S(e,t){return 0<t?e[e.length-1]:e[0]}function A(e,t){if(!e)return-1;t=t||e.nodeName;for(var i=0;e=e.previousElementSibling;)e.matches(t)&&i++;return i}function x(e,t){for(const i in t)e.setAttribute(i,t[i])}var k,F=0;class e extends(k=class{constructor(){this._events={}}on(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}off(e,t){var i=arguments.length;return 0===i?delete this._events:1===i?delete this._events[e]:(this._events=this._events||{},void(e in this._events!=0&&this._events[e].splice(this._events[e].indexOf(t),1)))}trigger(e){if(this._events=this._events||{},e in this._events!=0)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},k.plugins={},class extends k{static define(e,t){k.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,i,s,n=[];if(this.plugins={names:[],settings:{},requested:{},loaded:{}},Array.isArray(e))for(t=0,i=e.length;t<i;t++)"string"==typeof e[t]?n.push(e[t]):(this.plugins.settings[e[t].name]=e[t].options,n.push(e[t].name));else if(e)for(s in e)e.hasOwnProperty(s)&&(this.plugins.settings[s]=e[s],n.push(s));for(;n.length;)this.require(n.shift())}loadPlugin(e){var t=this.plugins,i=k.plugins[e];if(!k.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');t.requested[e]=!0,t.loaded[e]=i.fn.apply(this,[this.plugins.settings[e]||{}]),t.names.push(e)}require(e){var t=this.plugins;if(!this.plugins.loaded.hasOwnProperty(e)){if(t.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');this.loadPlugin(e)}return t.loaded[e]}}){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.tab_key=!1,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreBlur=!1,this.hasOptions=!1,this.currentResults=null,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.renderCache={item:{},option:{}},F++;var s,n,o,i=y(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this,e=(window.getComputedStyle&&window.getComputedStyle(i,null)).getPropertyValue("direction"),this.settings=p(i,t),this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag="select"===i.tagName.toLowerCase(),this.rtl=/rtl/i.test(e),this.inputId=m(i,"tomselect-"+F),this.isRequired=i.required,this.settings.load&&this.settings.loadThrottle&&(this.settings.load=(s=this.settings.load,n=this.settings.loadThrottle,function(e,t){var i=this;o&&(i.loading=Math.max(i.loading-1,0)),clearTimeout(o),o=setTimeout(function(){o=null,i.loadedSearches[e]=!0,s.call(i,e,t)},n)})),this.sifter=new a(this.options,{diacritics:this.settings.diacritics}),this.setupOptions(this.settings.options,this.settings.optgroups),delete this.settings.optgroups,delete this.settings.options,this.settings.mode=this.settings.mode||(1===this.settings.maxItems?"single":"multi"),"boolean"!=typeof this.settings.hideSelected&&(this.settings.hideSelected="multi"===this.settings.mode),"boolean"!=typeof this.settings.hidePlaceholder&&(this.settings.hidePlaceholder="multi"!==this.settings.mode);var r=this.settings.createFilter;"function"!=typeof r&&((r="string"==typeof r?new RegExp(r):r)instanceof RegExp?this.settings.createFilter=e=>r.test(e):this.settings.createFilter=()=>!0),this.initializePlugins(this.settings.plugins),this.setupCallbacks(),this.setupTemplates(),this.setup()}setup(){var e,i,s,n,t,o=this,r=o.settings,a=o.input,l={passive:!0},d=o.inputId+"-ts-dropdown",c=o.settings.mode,p=a.getAttribute("class")||"";if(b(e=y("<div>"),r.wrapperClass,p,c),b(i=y('<div class="items">'),r.inputClass),e.append(i),b(n=o.render("dropdown"),r.dropdownClass,c),b(t=y(`<div style="scroll-behavior: smooth;" role="listbox" id="${d}" tabindex="-1">`),r.dropdownContentClass),n.append(t),y(r.dropdownParent||e).appendChild(n),r.controlInput)s=y(r.controlInput);else{s=y('<input type="text" autocomplete="off" />');for(const e of["autocorrect","autocapitalize","autocomplete"])a.getAttribute(e)&&x(s,{[e]:a.getAttribute(e)})}r.controlInput||(s.tabIndex=a.disabled?-1:o.tabIndex,i.appendChild(s)),x(s,{role:"combobox",haspopup:"listbox","aria-expanded":"false","aria-controls":d});var u,c=m(s,o.inputId+"-tomselected"),d="label[for='"+o.inputId.replace(/['"\\]/g,"\\$&")+"']",d=document.querySelector(d);d&&(x(d,{for:c}),x(t,{"aria-labelledby":m(d,o.inputId+"-ts-label")})),o.settings.copyClassesToDropdown&&b(n,p),e.style.width=a.style.width,o.plugins.names.length&&(u="plugin-"+o.plugins.names.join(" plugin-"),b([e,n],u)),(null===r.maxItems||1<r.maxItems)&&o.is_select_tag&&x(a,{multiple:"multiple"}),o.settings.placeholder&&x(s,{placeholder:r.placeholder}),!o.settings.splitOn&&o.settings.delimiter&&(u=o.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),o.settings.splitOn=new RegExp("\\s*"+u+"+\\s*")),o.control=i,o.control_input=s,o.wrapper=e,o.dropdown=n,o.dropdown_content=t,o.control_input.type=a.type,f(n,"mouseenter",e=>{var t=_(e.target,"[data-selectable]",n);if(t)return o.onOptionHover(e,t)},{capture:!0}),f(i,"mousedown",e=>{if(e.target==s)return o.clearActiveItems(),e.stopPropagation(),void o.inputState();var t=_(e.target,"."+o.settings.itemClass,i);return t?o.onItemSelect(e,t):o.onMouseDown(e)}),f(i,"click",e=>o.onClick(e)),f(s,"keydown",e=>o.onKeyDown(e)),f(s,"keyup",e=>o.onKeyUp(e)),f(s,"keypress",e=>o.onKeyPress(e)),f(s,"resize",()=>o.positionDropdown(),l),f(s,"blur",e=>o.onBlur(e)),f(s,"focus",e=>{o.ignoreBlur=!1,o.onFocus(e)}),f(s,"paste",e=>o.onPaste(e));var h=e=>{var t=_(e.target,"[data-selectable]",o.dropdown);if(!t&&!o.wrapper.contains(e.target))return o.isFocused&&o.blur(),void o.inputState();v(e,!0),t&&o.onOptionSelect(e,t)},g=()=>{o.isOpen&&o.positionDropdown()};f(document,"mousedown",h),f(window,"sroll",g,l),f(window,"resize",g,l),o._destroy=()=>{document.removeEventListener("mousedown",h),window.removeEventListener("sroll",g),window.removeEventListener("resize",g)},this.revertSettings={children:[...a.children],tabIndex:a.tabIndex},a.tabIndex=-1,x(a,{hidden:"hidden"}),a.insertAdjacentElement("afterend",o.wrapper),o.setValue(r.items),delete r.items,f(a,"invalid",e=>{v(e),o.isInvalid||(o.isInvalid=!0,o.refreshState())}),o.updateOriginalInput(),o.refreshItems(),o.refreshState(),o.inputState(),o.isSetup=!0,a.disabled&&o.disable(),o.on("change",this.onChange),b(a,"tomselected"),o.trigger("initialize"),!0===r.preload&&o.load("")}setupOptions(e=[],t=[]){for(const t of e)this.registerOption(t);for(const e of t)this.registerOptionGroup(e)}setupTemplates(){var i=this.settings.labelField,s=this.settings.optgroupLabelField;this.settings.render=Object.assign({},{optgroup:(e,t)=>{let i=document.createElement("div");return i.className="optgroup",i.appendChild(e.options),i},optgroup_header:(e,t)=>'<div class="optgroup-header">'+t(e[s])+"</div>",option:(e,t)=>"<div>"+t(e[i])+"</div>",item:(e,t)=>"<div>"+t(e[i])+"</div>",option_create:(e,t)=>'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>",no_results:(e,t)=>'<div class="no-results">No results found</div>',loading:(e,t)=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>'<div style="display:none"></div>'},this.settings.render)}setupCallbacks(){var e,t,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in i)(t=this.settings[i[e]])&&this.on(e,t)}onClick(e){this.isFocused&&this.isOpen||(this.focus(),v(e))}onMouseDown(e){var t=this;if(t.isFocused)return"single"!==t.settings.mode&&t.setActiveItem(),t.open(),!1;setTimeout(()=>t.focus(),0)}onChange(){n(this.input,"input"),n(this.input,"change")}onPaste(e){var i=this;i.isFull()||i.isInputHidden||i.isLocked?v(e):i.settings.splitOn&&setTimeout(()=>{var e=i.inputValue();if(e.match(i.settings.splitOn)){e=e.trim().split(i.settings.splitOn);for(const t of e)i.createItem(t)}},0)}onKeyPress(e){var t=this;if(!t.isLocked){var i=String.fromCharCode(e.keyCode||e.which);return t.settings.create&&"multi"===t.settings.mode&&i===t.settings.delimiter?(t.createItem(),void v(e)):void 0}v(e)}onKeyDown(e){var t,i=this;if(i.isLocked)9!==e.keyCode&&v(e);else{switch(e.keyCode){case 65:if(c(d,e))return void i.selectAll();break;case 27:return i.isOpen&&(v(e,!0),i.close()),void i.clearActiveItems();case 40:return!i.isOpen&&i.hasOptions?i.open():!i.activeOption||(t=i.getAdjacent(i.activeOption,1))&&i.setActiveOption(t),void v(e);case 38:return!i.activeOption||(t=i.getAdjacent(i.activeOption,-1))&&i.setActiveOption(t),void v(e);case 13:return void(i.isOpen&&i.activeOption&&(i.onOptionSelect(e,i.activeOption),v(e)));case 37:return void i.advanceSelection(-1,e);case 39:return void i.advanceSelection(1,e);case 9:return i.settings.selectOnTab&&i.isOpen&&i.activeOption&&(i.tab_key=!0,i.onOptionSelect(e,i.activeOption),v(e),i.tab_key=!1),void(i.settings.create&&i.createItem()&&v(e));case 8:case 46:return void i.deleteSelection(e)}i.isInputHidden&&!c(d,e)&&v(e)}}onKeyUp(e){var t=this;t.isLocked?v(e):(e=t.inputValue(),t.lastValue!==e&&(t.lastValue=e,t.settings.shouldLoad.call(t,e)&&t.load(e),t.refreshOptions(),t.trigger("type",e)))}onFocus(e){var t=this,i=t.isFocused;if(t.isDisabled)return t.blur(),void v(e);t.ignoreFocus||(t.isFocused=!0,"focus"===t.settings.preload&&t.load(""),i||t.trigger("focus"),t.activeItems.length||(t.showInput(),t.setActiveItem(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){var t=this;if(t.isFocused){if(t.isFocused=!1,t.ignoreFocus=!1,!t.ignoreBlur&&document.activeElement===t.dropdown_content)return t.ignoreBlur=!0,void t.onFocus(e);e=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,!1,e):e()}}onOptionHover(e,t){}onOptionSelect(e,t){var i=this;t&&(t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?i.createItem(null,!0,()=>{i.settings.closeAfterSelect&&i.close()}):void 0!==(t=t.dataset.value)&&(i.lastQuery=null,i.addItem(t),i.settings.closeAfterSelect?i.close():!i.settings.hideSelected&&e.type&&/mouse/.test(e.type)&&i.setActiveOption(i.getOption(t)))))}onItemSelect(e,t){this.isLocked||"multi"===this.settings.mode&&(v(e),this.setActiveItem(t,e))}load(e){var i=this,t=i.settings.load;t&&(i.loadedSearches.hasOwnProperty(e)||(b(i.wrapper,i.settings.loadingClass),i.loading++,t.call(i,e,function(e,t){i.loading=Math.max(i.loading-1,0),i.lastQuery=null,i.clearActiveOption(),i.setupOptions(e,t),i.refreshOptions(i.isFocused&&!i.isInputHidden),i.loading||I(i.wrapper,i.settings.loadingClass),i.trigger("load",e,t)})))}onSearchChange(e){this.load(e)}setTextboxValue(e=""){var t=this.control_input;t.value!==e&&(t.value=e,n(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){s(this,t?[]:["change"],()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){this.settings.maxItems=e=0===e?null:e,this.refreshState()}setActiveItem(e,t){var i,s,n,o,r,a=this;if("single"!==a.settings.mode){if(!e)return a.clearActiveItems(),void(a.isFocused&&a.showInput());if("mousedown"===(i=t&&t.type.toLowerCase())&&c("shiftKey",t)&&a.activeItems.length){for(r=a.getLastActive(),(n=Array.prototype.indexOf.call(a.control.children,r))>(o=Array.prototype.indexOf.call(a.control.children,e))&&(r=n,n=o,o=r),s=n;s<=o;s++)e=a.control.children[s],-1===a.activeItems.indexOf(e)&&a.setActiveItemClass(e);v(t)}else"mousedown"===i&&c(d,t)||"keydown"===i&&c("shiftKey",t)?e.classList.contains("active")?a.removeActiveItem(e):a.setActiveItemClass(e):(a.clearActiveItems(),a.setActiveItemClass(e));a.hideInput(),a.isFocused||a.focus()}}setActiveItemClass(e){var t=this.control.querySelector(".last-active");t&&I(t,"last-active"),b(e,"active last-active"),-1==this.activeItems.indexOf(e)&&this.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),I(e,"active")}clearActiveItems(){I(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e){var t,i,s;e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,x(this.control_input,{"aria-activedescendant":e.getAttribute("id")}),x(e,{"aria-selected":"true"}),b(e,"active"),t=this.dropdown_content.clientHeight,i=this.dropdown_content.scrollTop||0,s=this.activeOption.offsetHeight,(e=this.activeOption.getBoundingClientRect().top-this.dropdown_content.getBoundingClientRect().top+i)+s>t+i?this.dropdown_content.scrollTop=e-t+s:e<i&&(this.dropdown_content.scrollTop=e)))}clearActiveOption(){this.activeOption&&(I(this.activeOption,"active"),this.activeOption.removeAttribute("aria-selected")),this.activeOption=null,this.control_input.removeAttribute("aria-activedescendant")}selectAll(){"single"!==this.settings.mode&&(this.activeItems=this.controlChildren(),this.activeItems.length&&(b(this.activeItems,"active"),this.hideInput(),this.close()),this.focus())}inputState(){var e=this;e.settings.controlInput||(0<e.activeItems.length||!e.isFocused&&this.settings.hidePlaceholder&&0<e.items.length?(e.setTextboxValue(),e.isInputHidden=!0,b(e.wrapper,"input-hidden")):(e.isInputHidden=!1,I(e.wrapper,"input-hidden")))}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.control_input.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.control_input.blur(),this.onBlur(null)}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e,t=this.settings;return"string"==typeof t.sortField&&(e=[{field:t.sortField}]),{fields:t.searchField,conjunction:t.searchConjunction,sort:e,nesting:t.nesting}}search(e){var t,i,s,n=this,o=n.settings,r=this.getSearchOptions();if(o.score&&"function"!=typeof(s=n.settings.score.call(n,e)))throw new Error('Tom Select "score" setting must be a function that returns a function');if(e!==n.lastQuery?(n.lastQuery=e,i=n.sifter.search(e,Object.assign(r,{score:s})),n.currentResults=i):i=Object.assign({},n.currentResults),o.hideSelected)for(t=i.items.length-1;0<=t;t--)-1!==n.items.indexOf(C(i.items[t].id))&&i.items.splice(t,1);return i}refreshOptions(e=!0){var s,n,o,r,a,l,t,i,d,c,p,u,h,g,v=this,f=v.inputValue(),m=v.search(f),y=v.activeOption&&C(v.activeOption.dataset.value),b=v.settings.shouldOpen||!1,O=m.items.length;for(0<(O="number"==typeof v.settings.maxOptions?Math.min(O,v.settings.maxOptions):O)&&(b=!0),c={},r=[],s=0;s<O;s++){let e=v.options[m.items[s].id],t=C(e[v.settings.valueField]),i=v.getOption(t);for(i=i||v.render("option",e),v.settings.hideSelected||i.classList.toggle("selected",v.items.includes(t)),a=e[v.settings.optgroupField]||"",n=0,o=(l=Array.isArray(a)?a:[a])&&l.length;n<o;n++)a=l[n],v.optgroups.hasOwnProperty(a)||(a=""),c.hasOwnProperty(a)||(c[a]=document.createDocumentFragment(),r.push(a)),0<n&&(i=i.cloneNode(!0),I(i,"active"),i.removeAttribute("aria-selected")),c[a].appendChild(i)}for(a of(this.settings.lockOptgroupOrder&&r.sort((e,t)=>(v.optgroups[e]&&v.optgroups[e].$order||0)-(v.optgroups[t]&&v.optgroups[t].$order||0)),t=document.createDocumentFragment(),r))if(v.optgroups.hasOwnProperty(a)&&c[a].children.length){let e=document.createDocumentFragment();e.appendChild(v.render("optgroup_header",v.optgroups[a])),e.appendChild(c[a]);var w=v.render("optgroup",{group:v.optgroups[a],options:e});t.appendChild(w)}else t.appendChild(c[a]);if(v.dropdown_content.innerHTML="",v.dropdown_content.appendChild(t),v.settings.highlight&&(v.dropdown_content,p=document.querySelectorAll("span.highlight"),Array.prototype.forEach.call(p,function(e,t){var i=e.parentNode;i.replaceChild(e.firstChild,e),i.normalize()}),m.query.length&&m.tokens.length))for(const e of m.tokens)u=v.dropdown_content,h=e.regex,g=void 0,"string"==typeof h&&!h.length||(g="string"==typeof h?new RegExp(h,"i"):h,function e(t){var i=0;if(3===t.nodeType){var s,n,o=t.data.search(g);0<=o&&0<t.data.length&&(n=t.data.match(g),(s=document.createElement("span")).className="highlight",(o=t.splitText(o)).splitText(n[0].length),n=o.cloneNode(!0),s.appendChild(n),o.parentNode.replaceChild(s,o),i=1)}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName)&&("highlight"!==t.className||"SPAN"!==t.tagName))for(var r=0;r<t.childNodes.length;++r)r+=e(t.childNodes[r]);return i}(u));var _=e=>{e=v.render(e,{input:f});return e&&(b=!0,v.dropdown_content.insertBefore(e,v.dropdown_content.firstChild)),e};if(v.settings.shouldLoad.call(v,f)?v.loading?_("loading"):0===m.items.length&&_("no_results"):_("not_loading"),(p=v.canCreate(f))&&(d=_("option_create")),v.hasOptions=0<m.items.length||p,b){if(0<m.items.length){if(!(i=y&&v.getOption(y))||!v.dropdown_content.contains(i)){let e=0;d&&!v.settings.addPrecedence&&(e=1),i=v.selectable()[e]}}else i=d;v.setActiveOption(i),e&&!v.isOpen&&v.open()}else v.clearActiveOption(),e&&v.isOpen&&v.close()}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e){var t,i=this;if(Array.isArray(e))for(const t of e)i.addOption(t);else(t=i.registerOption(e))&&(i.userOptions[t]=!0,i.lastQuery=null,i.trigger("option_add",t,e))}registerOption(e){var t=C(e[this.settings.valueField]);return null!==t&&!this.options.hasOwnProperty(t)&&(e.$order=e.$order||++this.order,e.$id=this.inputId+"-opt-"+Object.keys(this.options).length,this.options[t]=e,t)}registerOptionGroup(e){var t=C(e[this.settings.optgroupValueField]);return null!==t&&(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){t[this.settings.optgroupValueField]=e,(e=this.registerOptionGroup(t))&&this.trigger("optgroup_add",e,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){var i,s,n,o=this;if(e=C(e),i=C(t[o.settings.valueField]),null!==e&&o.options.hasOwnProperty(e)){if("string"!=typeof i)throw new Error("Value must be set in option data");n=o.options[e].$order,i!==e&&(delete o.options[e],-1!==(s=o.items.indexOf(e))&&o.items.splice(s,1,i)),t.$order=t.$order||n,o.options[i]=t,s=o.renderCache.item,n=o.renderCache.option,s&&(delete s[e],delete s[i]),n&&(delete n[e],delete n[i]),-1!==o.items.indexOf(i)&&(e=o.getItem(e),t=o.render("item",t),e.classList.contains("active")&&b(t,"active"),e.parentNode.insertBefore(t,e),e.remove()),o.lastQuery=null,o.isOpen&&o.refreshOptions(!1)}}removeOption(e,t){var i=this;e=C(e);var s=i.renderCache.item,n=i.renderCache.option;s&&delete s[e],n&&delete n[e],delete i.userOptions[e],delete i.options[e],i.lastQuery=null,i.trigger("option_remove",e),i.removeItem(e,t)}clearOptions(){this.loadedSearches={},this.userOptions={},this.clearCache();var e,t={};for(e in this.options)this.options.hasOwnProperty(e)&&0<=this.items.indexOf(e)&&(t[e]=this.options[e]);this.options=this.sifter.items=t,this.lastQuery=null,this.trigger("option_clear")}getOption(e){return this.renderCache.option.hasOwnProperty(e)?this.renderCache.option[e]:this.getElementWithValue(e,this.selectable())}getAdjacent(e,t,i="option"){var s,n=e;if(e){s="item"==i?this.settings.itemClass:this.settings.optionClass;do{if((n=0<t?n.nextSibling:n.previousSibling)&&n.classList.contains(s))return n}while(n)}}getElementWithValue(t,e){if(null!==(t=C(t)))for(const i of e){let e=i;if(e.getAttribute("data-value")===t)return e}}getItem(e){return this.getElementWithValue(e,this.control.children)}addItems(e,i){this.buffer=document.createDocumentFragment();for(const t of this.control.children)this.buffer.appendChild(t);var s=Array.isArray(e)?e:[e];for(let e=0,t=s.length;e<t;e++)this.isPending=e<t-1,this.addItem(s[e],i);e=this.control;e.insertBefore(this.buffer,e.firstChild),this.buffer=null}addItem(r,a){s(this,a?[]:["change"],()=>{var e,t,i,s,n=this,o=n.settings.mode;r=C(r),-1!==n.items.indexOf(r)&&("single"===o&&n.close(),"single"===o||!n.settings.duplicates)||!n.options.hasOwnProperty(r)||("single"===o&&n.clear(a),"multi"===o&&n.isFull())||(s=n.render("item",n.options[r]),n.control.contains(s)&&(s=s.cloneNode(!0)),e=n.isFull(),n.items.splice(n.caretPos,0,r),n.insertAtCaret(s),n.isSetup&&(t=n.selectable(),n.isPending||(i=n.getOption(r),i=n.getAdjacent(i,1),n.refreshOptions(n.isFocused&&"single"!==o),i&&n.setActiveOption(i)),!t.length||n.isFull()?n.close():n.isPending||n.positionDropdown(),n.trigger("item_add",r,s),n.isPending||n.updateOriginalInput({silent:a})),n.isPending&&(e||!n.isFull())||n.refreshState())})}removeItem(e,t){var i,s,n=this,o=n.getItem(e);o&&(e=C(o.dataset.value),-1!==(i=n.items.indexOf(e))&&(o.remove(),o.classList.contains("active")&&(s=n.activeItems.indexOf(o),n.activeItems.splice(s,1),I(o,"active")),n.items.splice(i,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(e)&&n.removeOption(e,t),i<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",e,o)))}createItem(e,i=!0,s){var n=this,o=n.caretPos;if(e=e||n.inputValue(),"function"!=typeof s&&(s=()=>{}),!n.canCreate(e))return s(),!1;n.lock();var r=!1,t=e=>{if(n.unlock(),!e||"object"!=typeof e)return s();var t=C(e[n.settings.valueField]);if("string"!=typeof t)return s();n.setTextboxValue(),n.addOption(e),n.setCaret(o),n.addItem(t),n.refreshOptions(i&&"single"!==n.settings.mode),s(e),r=!0},e="function"==typeof n.settings.create?n.settings.create.call(this,e,t):{[n.settings.labelField]:e,[n.settings.valueField]:e};return r||t(e),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){var e=this;e.refreshValidityState();var t=e.isFull(),i=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);var s=e.control.classList;s.toggle("focus",e.isFocused),s.toggle("disabled",e.isDisabled),s.toggle("required",e.isRequired),s.toggle("invalid",e.isInvalid),s.toggle("locked",i),s.toggle("full",t),s.toggle("not-full",!t),s.toggle("input-active",e.isFocused&&!e.isInputHidden),s.toggle("dropdown-active",e.isOpen),s.toggle("has-options",(t=e.options,0===Object.keys(t).length)),s.toggle("has-items",0<e.items.length)}refreshValidityState(){var e,t=this;t.input.checkValidity&&(this.isRequired&&(t.input.required=!0),e=!t.input.checkValidity(),t.isInvalid=e,t.control_input.required=e,this.isRequired&&(t.input.required=!e))}isFull(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){var t,i,s=this;s.is_select_tag?(t=[],s.input.querySelectorAll("option").forEach(function(e){t.push(e.value),-1==s.items.indexOf(e.value)?e.selected=!1:e.selected=!0}),s.items.forEach(function(e){-1==t.indexOf(e)&&(i=s.options[e][s.settings.labelField]||"",s.input.innerHTML+='<option value="'+r(e)+'" selected="selected">'+r(i)+"</option>")})):s.input.value=s.getValue(),s.isSetup&&(e.silent||s.trigger("change",s.getValue()))}open(){var e=this;e.isLocked||e.isOpen||"multi"===e.settings.mode&&e.isFull()||(e.isOpen=!0,x(e.control_input,{"aria-expanded":"true"}),e.refreshState(),u(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),u(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(){var e=this,t=e.isOpen;"single"===e.settings.mode&&e.items.length&&(e.hideInput(),e.tab_key||e.blur()),e.isOpen=!1,x(e.control_input,{"aria-expanded":"false"}),u(e.dropdown,{display:"none"}),e.clearActiveOption(),e.refreshState(),e.setTextboxValue(),t&&e.trigger("dropdown_close",e.dropdown)}positionDropdown(){var e,t,i;"body"===this.settings.dropdownParent&&(e=(i=this.control).getBoundingClientRect(),t=i.offsetHeight+e.top+window.scrollY,i=e.left+window.scrollX,u(this.dropdown,{width:e.width+"px",top:t+"px",left:i+"px"}))}clear(e){var t=this;if(t.items.length){for(const e of t.controlChildren())e.remove();t.items=[],t.lastQuery=null,t.setCaret(0),t.setActiveItem(),t.updateOriginalInput({silent:e}),t.refreshState(),t.showInput(),t.trigger("clear")}}insertAtCaret(e){var t=this,i=Math.min(t.caretPos,t.items.length),s=t.buffer||t.control;0===i?s.insertBefore(e,s.firstChild):s.insertBefore(e,s.children[i]),t.setCaret(i+1)}deleteSelection(e){var t,i=this,s=e&&8===e.keyCode?-1:1,n={start:(n=i.control_input).selectionStart,length:n.selectionEnd-n.selectionStart},o=[];if(i.activeItems.length){t=A(S(i.activeItems,s)),0<s&&t++;for(const e of i.activeItems)o.push(e.dataset.value)}else(i.isFocused||"single"===i.settings.mode)&&i.items.length&&(s<0&&0===n.start&&0===n.length?o.push(i.items[i.caretPos-1]):0<s&&n.start===i.inputValue().length&&o.push(i.items[i.caretPos]));if(!o.length||"function"==typeof i.settings.onDelete&&!1===i.settings.onDelete.call(i,o,e))return!1;for(v(e,!0),void 0!==t&&i.setCaret(t);o.length;)i.removeItem(o.pop());return i.showInput(),i.positionDropdown(),i.refreshOptions(!1),!0}advanceSelection(e,t){var i,s=this;s.rtl&&(e*=-1),s.inputValue().length||(c(d,t)||c("shiftKey",t)?(t=(i=s.getLastActive(e))?i.classList.contains("active")?s.getAdjacent(i,e,"item"):i:0<e?s.control_input.nextElementSibling:s.control_input.previousElementSibling)&&(t.classList.contains("active")&&s.removeActiveItem(i),s.setActiveItemClass(t)):s.isFocused&&!s.activeItems.length?s.setCaret(s.caretPos+e):(i=s.getLastActive(e))&&(i=A(i),s.setCaret(0<e?i+1:i),s.setActiveItem()))}getLastActive(e){var t=this.control.querySelector(".last-active");if(t)return t;t=this.control.querySelectorAll(".active");return t?S(t,e):void 0}setCaret(e){var t=this;if("single"===t.settings.mode||t.settings.controlInput)e=t.items.length;else if((e=Math.max(0,Math.min(t.items.length,e)))!=t.caretPos&&!t.isPending){var i,s=t.controlChildren();for(i in s)i<e?t.control_input.insertAdjacentElement("beforebegin",s[i]):t.control.appendChild(s[i])}t.caretPos=e}controlChildren(){return[...this.control.getElementsByClassName(this.settings.itemClass)]}lock(){this.close(),this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.control_input.tabIndex=-1,e.isDisabled=!0,e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.control_input.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML="",e.input.tabIndex=t.tabIndex,I(e.input,"tomselected"),e.input.removeAttribute("hidden"),e.input.required=this.isRequired;for(const i of t.children)e.input.appendChild(i);e._destroy(),delete e.input.tomselect}render(e,t){var i,s=this;if(("option"===e||"item"===e)&&(i=C(t[s.settings.valueField]),s.renderCache[e].hasOwnProperty(i)))return s.renderCache[e][i];var n=s.settings.render[e];return"function"!=typeof n?null:((n=n.call(this,t,r))&&(n=y(n),"option"===e||"option_create"===e?t[s.settings.disabledField]?x(n,{"aria-disabled":"true"}):x(n,{"data-selectable":""}):"optgroup"===e&&(x(n,{"data-group":t.group[s.settings.optgroupValueField]}),t.group[s.settings.disabledField]&&x(n,{"data-disabled":""})),"option"!==e&&"item"!==e||(x(n,{"data-value":i}),"item"===e?b(n,s.settings.itemClass):(b(n,s.settings.optionClass),x(n,{role:"option",id:t.$id})),s.renderCache[e][i]=n)),n)}clearCache(e){void 0===e?this.renderCache={item:{},option:{}}:this.renderCache[e]={}}canCreate(e){return this.settings.create&&e.length&&this.settings.createFilter.call(this,e)}hook(i,e,s){var n=this,o=n[e];n[e]=function(){var e,t;return"after"===i&&(e=o.apply(n,arguments)),t=s.apply(n,arguments),"instead"===i?t:e="before"===i?o.apply(n,arguments):e}}}return e.define("change_listener",function(e){var t=this,i=!1;f(t.input,"change",()=>{var e;i?i=!1:(i=!0,e=p(t.input,{}),t.setupOptions(e.options,e.optgroups),t.setValue(e.items))})}),e.define("checkbox_options",function(e){var n=this,i=n.onOptionSelect;n.settings.hideSelected=!1;function s(e){var t=e.querySelector("input");e.classList.contains("selected")?t.checked=!0:t.checked=!1}n.hook("after","setupTemplates",()=>{var s=n.settings.render.option;n.settings.render.option=function(e){var t=y(s.apply(n,arguments)),i=document.createElement("input");i.addEventListener("click",function(e){v(e)}),i.type="checkbox";e=C(e[n.settings.valueField]);return-1<n.items.indexOf(e)&&(i.checked=!0),t.prepend(i),t}}),n.on("item_remove",e=>{e=n.getOption(e);e&&(e.classList.remove("selected"),s(e))}),n.hook("instead","onOptionSelect",function(e,t){return t.classList.contains("selected")?(t.classList.remove("selected"),n.removeItem(t.dataset.value),n.refreshOptions(),void v(e,!0)):i.apply(n,arguments)}),n.hook("after","onOptionSelect",(e,t)=>{s(t)})}),e.define("clear_button",function(t){var i=this;t=Object.assign({className:"clear-button",title:"Clear All",html:e=>`<div class="${e.className}" title="${e.title}">&times;</div>`},t),i.hook("after","setup",()=>{var e=y(t.html(t));e.addEventListener("click",e=>{for(;0<i.items.length;)i.removeItem(i.items[0]);e.preventDefault(),e.stopPropagation()}),i.control.appendChild(e)})}),e.define("drag_drop",function(e){var t,i,s=this;if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');"multi"===s.settings.mode&&(t=s.lock,i=s.unlock,s.hook("instead","lock",function(){var e=s.control.dataset.sortable;return e&&e.disable(),t.apply(s,arguments)}),s.hook("instead","unlock",function(){var e=s.control.dataset.sortable;return e&&e.enable(),i.apply(s,arguments)}),s.hook("after","setup",()=>{var i=$(s.control).sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:s.isLocked,start:(e,t)=>{t.placeholder.css("width",t.helper.css("width")),i.css({overflow:"visible"})},stop:()=>{i.css({overflow:"hidden"});var e=[];i.children("[data-value]").each(function(){e.push($(this).attr("data-value"))}),s.setValue(e)}})}))}),e.define("dropdown_header",function(i){var s=this;i=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:e=>'<div class="'+e.headerClass+'"><div class="'+e.titleRowClass+'"><span class="'+e.labelClass+'">'+e.title+'</span><a class="'+e.closeClass+'">&times;</a></div></div>'},i),s.hook("after","setup",()=>{var e=y(i.html(i)),t=e.querySelector("."+i.closeClass);t&&t.addEventListener("click",e=>{v(e,!0),s.close()}),s.dropdown.insertBefore(e,s.dropdown.firstChild)})}),e.define("dropdown_input",function(){var t=this,i=y(i=t.settings.controlInput||'<input type="text" autocomplete="off" class="dropdown-input" />');t.settings.placeholder&&x(i,{placeholder:t.settings.placeholder}),t.settings.controlInput=i,t.settings.shouldOpen=!0,t.hook("after","setup",()=>{x(t.wrapper,{tabindex:t.input.disabled?"-1":t.tabIndex}),f(t.wrapper,"keypress",e=>{if(!t.control.contains(e.target)&&!t.dropdown.contains(e.target)&&13===e.keyCode)t.onClick(e)});let e=y('<div class="dropdown-input-wrap">');e.appendChild(i),t.dropdown.insertBefore(e,t.dropdown.firstChild)})}),e.define("input_autogrow",function(){var s=this;s.hook("after","setup",()=>{var e=document.createElement("span"),t=this.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",s.wrapper.appendChild(e);for(const s of["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"])e.style[s]=t.style[s];var i=()=>{0<this.items.length?(e.textContent=t.value,t.style.width=e.clientWidth+"px"):t.style.width=""};i(),this.on("update item_add item_remove",i),f(t,"input",i),f(t,"keyup",i),f(t,"blur",i),f(t,"update",i)})}),e.define("no_backspace_delete",function(){var e=this,t=e.deleteSelection;this.hook("instead","deleteSelection",function(){return!!e.activeItems.length&&t.apply(e,arguments)})}),e.define("no_active_items",function(e){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}),e.define("optgroup_columns",function(){var n=this,o=n.onKeyDown;n.hook("instead","onKeyDown",function(e){var t,i,s;return!n.isOpen||37!==e.keyCode&&39!==e.keyCode?o.apply(n,arguments):(s=_(n.activeOption,"[data-group]"),t=A(n.activeOption,"[data-selectable]"),void((s=37===e.keyCode?s.previousSibling:s.nextSibling)&&(i=(i=s.querySelectorAll("[data-selectable]"))[Math.min(i.length-1,t)])&&n.setActiveOption(i)))})}),e.define("remove_button",function(e){e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},e);var s,n=this;e.append&&(s='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+r(e.title)+'">'+e.label+"</a>",n.hook("after","setupTemplates",()=>{var i=n.settings.render.item;n.settings.render.item=function(){var t=y(i.apply(n,arguments)),e=y(s);return t.appendChild(e),f(e,"mousedown",e=>{v(e,!0)}),f(e,"click",e=>{v(e,!0),n.isLocked||(e=t.dataset.value,n.removeItem(e),n.refreshOptions(!1))}),t}}))}),e.define("restore_on_backspace",function(t){var i=this;t.text=t.text||function(e){return e[i.settings.labelField]},i.on("item_remove",function(e){""!==i.control_input.value.trim()||(e=i.options[e])&&i.setTextboxValue(t.text.call(i,e))})}),e});var tomSelect=function(e,t){return new TomSelect(e,t)};const search_form=document.querySelector(".search-form form"),search_input=search_form.querySelector("input");search_form.addEventListener("submit",e=>{let t=e.target.closest(".search-form");""===t.querySelector("input").value&&(e.preventDefault(),t.classList.add("search-form_focus"),t.querySelector("input").focus())}),search_input.addEventListener("blur",t=>{if(""===t.target.value){let e=t.target.closest(".search-form");e.classList.remove("search-form_focus")}});const mobile_button=document.querySelector(".header__mobile-button");mobile_button.addEventListener("click",function(e){e.target.closest(".header").classList.toggle("header_open")});let footer_dropdown=document.querySelector(".footer__dropdown");footer_dropdown.addEventListener("click",function(e){e.stopPropagation(),e.target.closest(".footer__dropdown").classList.toggle("footer__dropdown_opened")}),document.addEventListener("click",function(){footer_dropdown.classList.remove("footer__dropdown_opened")});let tabs_block=document.querySelectorAll(".tabs");tabs_block.forEach(e=>{let s=e.querySelectorAll(".tabs .tabs__nav__item"),n=e.querySelectorAll(".tabs .tabs__content__item");s.forEach((e,i)=>{0===i&&e.classList.add("tabs__nav__item_active"),e.addEventListener("click",e=>{n.forEach((e,t)=>{t===i?(s[t].classList.add("tabs__nav__item_active"),n[t].classList.add("tabs__content__item_active")):(s[t].classList.remove("tabs__nav__item_active"),n[t].classList.remove("tabs__content__item_active"))})})})});